<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Thrift</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="{{url_for('static', filename='stylesheets/login.css')}}">
</head>

<body>
  <div class="container-fluid">


    {% if current_user.is_authenticated %}
    <p>logged in</p>
    {% endif %}



    <section name='Login Logic'>

      {% if not current_user.is_authenticated %}
      <div id='title' class="row">
        <div class="col-md-4 col-12 " style="position:absolute; top:20%; left:10%;">

          <h2>The small businesses you love</h2>
          <h2 class="mt-3" style="margin-left:70px;">At a place you can hear them</h2>
        </div>
      </div>

      <div class="card" id="bademail" style="z-index: 100; display:none; position:absolute; top:45%; left:45%">
        <h5 style="width:100%; margin:10px;" id="error"></h5>
          <a name='poop' style="width:100px; margin:auto; margin-bottom:10px;" class="btn btn-warning" id="warningbutton">Okay</a>
      </div>

      {% include 'loginform.html' %}
      {% include 'registerform.html' %}


      {% endif %}
    </section>

  </div>

<script type="text/javascript">
$('#register').submit(function(e) {
  let b = $(this).find('input[name="type"]:checked').val();
  var lat = 0;
  var lng = 0;
    e.preventDefault();
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position){

           lat = position.coords.latitude;
           lng = position.coords.longitude;
           loc = String(lat) + ',' + String(lng);
           e.preventDefault();
           req = $.ajax({
             url: 'register_account',
             type: 'POST',
             data: {
               email   : $('#register').find('input[name="email"]').val(),
               username: $('#register').find('input[name="name"]').val(),
               password: $('#register').find('input[name="password"]').val(),
               business: $('#register').find('input[name="type"]:checked').val(),
               loc     : loc,
               remember: $('#register').find('input[name="remember"]').prop('checked')
             }
           });

           req.done(function(data) {
             if (data.failure) {
               alert('Sorry, the ' + data.failure + ' you chose is already taken.')
             }
             else {
               if (b=='true'){
                 window.location.href = document.location.href + 'store';
               }
               if (b=='false') {
                 window.location.reload();
               }

             }
           });

      });
    }



});

$('#login').submit(function(e) {
  e.preventDefault();
  req = $.ajax({
    url: 'login',
    type: 'POST',
    data: {
      username: $(this).find('input[name="name"]').val(),
      password: $(this).find('input[name="password"]').val(),
      remember: $(this).find('input[name="remember"]').prop('checked')
    }
  });

  req.done(function(data) {
    if (data.failure) {
      alert('Sorry, your username or password is incorrect.')
    }
    else {

      window.location = document.location.href + '/store';
    }
  })

});

$('#shift-to-register').click(function(){
  $('#login').hide();
  $('#register').show(150);
});

$('#shift-to-login').click(function(){
  $('#register').hide();
  $('#login').show(150);
});


</script>
<!--  <script src="{{url_for('static', filename='scripts/loginlogic.js')}}" type="text/javascript"></script> -->

</body>

</html>
